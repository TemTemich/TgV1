# Importing Required Libraries, Imported os Module For Security
import os, telebot
import random
# Getting Bot Token From Secrets
global mistake_COUNTER
mistake_COUNTER = 0
text2_noMistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
_______________________$$$$$$$$$$$$$___
_____________$$$$$$$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$  
    """
text2_1Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
_______________________$$$$$$$$$$$$$___
_____________$$$$$$$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$  
    """
text2_2Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
___$$$$$$$________________$$$$$$$______
____$$$$$_________________$$$$$$$______
____$$$$$_________________$$$$$$$______
____$$$$$_________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
_______________________$$$$$$$$$$$$$___
_____________$$$$$$$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$  
    """
text2_3Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
__$$$$$$$$________________$$$$$$$______
__$_$$$$$_________________$$$$$$$______
__$_$$$$$_________________$$$$$$$______
__$_$$$$$_________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
_______________________$$$$$$$$$$$$$___
_____________$$$$$$$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$  
    """
text2_4Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
__$$$$$$$$$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
__________________________$$$$$$$______
_______________________$$$$$$$$$$$$$___
_____________$$$$$$$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
___________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$  
    """
text2_5Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
__$$$$$$$$$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
____$$_$$_________________$$$$$$$______
___$$_____________________$$$$$$$______
___$$_____________________$$$$$$$______
___$$__________________$$$$$$$$$$$$$___
$__$$_______$$$$$$$$$$$$$$$$$$$$$$$$$$$
_\_________/_______$$$$$$$$$$$$$$$$$$$$$
__\_______/________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
    """
text2_6Mistakes = """
    ___$$$$$$$$$$______Я-ВИСЕЛИЦО!________
___$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$___
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
______Z___________________$$$$$$$______
_____$$$__________________$$$$$$$______
____$$$$$_________________$$$$$$$______
_____$$$__________________$$$$$$$______
___$ZZZZZ$________________$$$$$$$______
__$$$$$$$$$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
__$_$$$$$_$_______________$$$$$$$______
____$$_$$_________________$$$$$$$______
___$$___$$________________$$$$$$$______
___$$___$$________________$$$$$$$______
___$$___$$_____________$$$$$$$$$$$$$___
$__$$___$$__$$$$$$$$$$$$$$$$$$$$$$$$$$$
_\_________/_______$$$$$$$$$$$$$$$$$$$$$
__\_______/________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
__________________$$$$$$$$$$$$$$$$$$$$$
    """
mistake_list = [text2_noMistakes, text2_1Mistakes, text2_2Mistakes, text2_3Mistakes, text2_4Mistakes, text2_5Mistakes, text2_6Mistakes]

BOT_TOKEN = os.environ.get('BOT_TOKEN')

# Creating Telebot Object
bot = telebot.TeleBot(BOT_TOKEN)

#//////////////////////////////////////////////////////////////////
word_list = ["лошадь", "алмаз", "александр", "канада", "грузовик"]
global word_itself, secret_word, points, points_reserve
points_reserve = 0
points = 0
letter_handler = 0
global z
z = 0

#//////////////////////////////////////////////////////////////////


@bot.message_handler(commands=['start_game'])
def start_game(message):
    
    global secret_word, word_itself, mistake_COUNTER
    mistake_COUNTER = 0
    word_itself = random.choice(word_list)
    word_coded = len(word_itself)

    secret_word = []
    for i in range(word_coded):
        secret_word.append("_")
    letter_handler = list(word_itself)
    bot.reply_to(message, " ".join(secret_word))


#def gallow(letter, word, message):
#    global z
#    for i in letter_handler:
#      if letter == i:
#        counter = letter_handler.count(i)
#        for i in range(counter):
#          z = letter_handler.index(i, z, len(letter_handler))
#          secret_word[z] == i
#          z+=1
#        bot.reply_to(message, " ".join(secret_word))
#        return secret_word
#      else:
#        pass


def new_secret_word(letter, word, secret_word):
    count_letter = word.count(letter)
    start = 0
    end = len(word)
    for i in range(count_letter):
        index_letter = word.index(letter, start, end)
        secret_word[index_letter] = letter
        start = index_letter + 1
    return secret_word


# Whenever Starting Bot
@bot.message_handler(commands=['start', 'hello'])
def send_welcome(message):
    markdown = f"""*{message.chat.first_name}*, приветстыую, я - бот по игре в висилицу.

  Правила простые: Палач(я) придумывает слово из 5 или более букв, а Висельник(ты) начинает загадывать разные буквы. Если буква есть в данном слове, Палач ставит ее в пробел в том месте, где она должна быть, а если буквы там нет, он начинает рисовать виселицу.

За каждоую верно угаданную букву подряд вы получаете на 1 очко больше, чем в прошлый."""
    bot.reply_to(message, markdown, parse_mode="Markdown")



    




@bot.message_handler(content_types=["text"])
def textInput(message):
    global word_itself, secret_word, points, mistake_COUNTER
    d = message.text
    if len(d) > 1:
        bot.reply_to(message,
                     "Слишком много букв, больше 1 буквы не перевариваю.")
    elif mistake_COUNTER >=6:
      bot.send_message(message.chat.id, "Сдох пацанчик, не получилось, не фортануло." + "\n" + "\n" + "Вы проиграли. Перезапустите игру")
      mistake_COUNTER = 0
      
    else:
        global word_itself, secret_word, points_reserve
        if d in word_itself:

            points_reserve += points + 1
            points += 1
            secret_word = new_secret_word(d, word_itself, secret_word)
            bot.reply_to(
                message, mistake_list[mistake_COUNTER] + "\n" + "\n" + "\n" + "\n" + " ".join(secret_word) + "\n" + "\n" + "Ваши очки: " +
                str(points_reserve))
        
        else:
            points = 0
            mistake_COUNTER+=1
            bot.reply_to(
                message, mistake_list[mistake_COUNTER] + "\n" + "\n" +
                "".join(secret_word))
    
  


# Handle Documents

# Waiting For New Messages
bot.infinity_polling()
